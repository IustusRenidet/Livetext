<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIVETEXT - Editar Recurso</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-dark text-light">
    <div class="container py-4">
        <h1 class="mb-4">Editar Recurso</h1>
        <form id="resourceForm" enctype="multipart/form-data" class="mb-3">
            <div class="mb-3">
                <label for="title" class="form-label">Título</label>
                <input type="text" id="title" class="form-control" required>
            </div>
            <div class="mb-3">
                <label for="category" class="form-label">Categoría</label>
                <select id="category" class="form-select">
                    <option value="otros">Otros</option>
                    <option value="documentos">Documentos</option>
                    <option value="videos">Videos</option>
                    <option value="imagenes">Imágenes</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="description" class="form-label">Descripción</label>
                <textarea id="description" rows="3" class="form-control"></textarea>
            </div>
            <div class="mb-3">
                <label for="files" class="form-label">Archivos (opcional)</label>
                <input type="file" id="files" class="form-control" multiple>
            </div>
            <button type="submit" class="btn btn-primary">Guardar</button>
            <button type="button" id="deleteBtn" class="btn btn-danger ms-2">Eliminar</button>
        </form>
    </div>

    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
    const params = new URLSearchParams(window.location.search);
    const id = params.get('id');
    const title = document.getElementById('title');
    const category = document.getElementById('category');
    const description = document.getElementById('description');
    const files = document.getElementById('files');

    async function loadResource() {
        try {
            const res = await axios.get(`/api/resources/${id}`);
            title.value = res.data.title || '';
            category.value = res.data.category || 'otros';
            description.value = res.data.description || '';
        } catch (err) {
            console.error('Error al cargar recurso:', err);
        }
    }
    if (id) loadResource();

    document.getElementById('resourceForm').addEventListener('submit', async e => {
        e.preventDefault();
        const formData = new FormData();
        formData.append('title', title.value);
        formData.append('category', category.value);
        formData.append('description', description.value);
        Array.from(files.files).forEach((f, i) => formData.append(`files[${i}]`, f));
        try {
            await axios.put(`/api/resources/${id}`, formData);
            alert('Recurso actualizado');
            window.location.href = '/dashboard';
        } catch (err) {
            alert('Error al actualizar');
            console.error(err);
        }
    });

    document.getElementById('deleteBtn').addEventListener('click', async () => {
        if (confirm('¿Eliminar este recurso?')) {
            try {
                await axios.delete(`/api/resources/${id}`);
                window.location.href = '/dashboard';
            } catch (err) {
                alert('Error al eliminar');
                console.error(err);
            }
        }
    });
    </script>
</body>
</html>
